# O'RELLY

## Micorservices Up & Running: 처음 시작하는 마이크로 서비스

### 1. 마이크로서비스 아키텍처로의 여정

### 2. 마이크로서비스 운영 모델 설계

### 3. 마이크로서비스 설계: SEED(S)프로세스

### 4. 마이크로서비스의 크기 조정: 서비스 경계

### 5. 데이터 처리

목표: 마이크로서비스가 '자체 데이터'를 소유해야 하는 이유 및 자체 데이터가 아키텍처에 미치는 영향을 설명, delegate, data lake, saga, event sourcing, command query responsibility segregation 등 마이크로서비스의 데이터 관리 패턴 알아봄, 예제 실행

* 마이크서비스는 서로 느슨하게 결합되어(서비스 변경이 용이) **독립적으로 배포**할 수 있어야 함
* 마이크로서비스 내부의 기능과 관련하여 높은 응집력을 가져야 함
* 이를 위해서 마이크로서비스는 데이터 공동 소유를 막고 '자체 데이터'를 가지고 있어야 한다.

* 그러나 데이터 포함으로 데이터베이스 클러스터 수가 급증해서는 안된다.
* redundancy, reliability, scalability를 제공해야 함

##### 5.2.2 데이터 포함 및 데이터 위임 패턴

데이터 공유 특성을 지닌 모놀리식 데이터 관리에서는, '항공편 검색', '예약', '항공편 추적' 총 세 개의 서비스가 '항공편 테이블'을 동시에 공유한다. 이러한 상황은 독립적인 배포 가능성을 손상시킨다.

이를 해결하기 위해 위임 서비스를 통해 데이터를 숨긴다. 서비스 요구사항을 면밀히 분석하여 유연한 API를 구현하는 것이 위임 서비스의 예라고 볼 수 있다. 위와 같은 서비스를 제공한다고 가정했을 때 항공편 검색 서비스는 항공편 정보와 관련된 모든 것을 처리할 권한을 가진 항공편 인벤토리 서비스 선언할 수 있으며 이러한 항공편 인벤토리 서비스를 이용하여 항공편에 대한 모든 정보를 얻을 수 있다.

그러나 분석, 데이터 감사, 머신 러닝과 같은 시스템의 경우 마이크로서비스 경계를 넘어 데이터에 접근하거나 수정이 필요하다. 또한 전통적인 데이터 트랜잭션도 공유 데이터를 잠가야 하낟.

##### 5.2.3 중복을 사용하여 독립 문제 해결

##### 5.2.4 분산 트랜잭션과 실패 처리

#### 5.3 이벤트 소싱과 CQRS

##### 5.3.1 이벤트 소싱

**관계형 모델링** 대신에 완전히 다른 방법으로 데이터 모델링을 전환해야 할 때도 있다. 마이크로 서비스에서 데이터 공유를 피할 수 있는 인기 있는 데이터 모델링 접근 방식으로 **이벤트 소싱**이 제안 되고 있다.

> 이벤트 소싱은 '사실'과 '상태(구조적 모델)'을 저장하는 것이다. '상태'는 사실에서 일차적으로 파생된 값이며 일시적이다.

ex) 회계 일지, 체스

**이벤트는 어떻게 생겼을까?**
```
{
  "eventId": "aaaa-bbbb-cccc-dddd"
  "eventType": "priceIncreased"
  "data": {
    "amount" : 120.99,
    "currency": "USD"
    }
}
```
COMMENT: json 파일 포맷으로 저장이 가능할 듯, key와 value를 가진 dictionay 형태로 제공, 아마 event.json?

**프로젝션으로 현재 상태 계산**
```
funtion priceUp(state,event){
  state.increasePrice(evnet.amount)
}
```

```
funtion priceUp(state,event){
  state.increasePrice(evnet.amount)
}
funtion priceDown(state,event){
  state.decreasePrice(evnet.amount)
}

let price = priceUp(priceUp(priceDown(s,e),e),e);
```

#### 5.3.2 롤링 스냅샷으로 성능 향상

프로젝션은 상대적으로 성능을 많이 잡아먹는다. 따라서 시간과 컴퓨팅 리소스를 낭비할 가능성이 있기 때문에 **롱링 스냅샷**이라는 방법을 이용한다.

#### 5.3.3 이벤트 스토어

#### 5.3.4 명령과 쿼리의 역할 분리

#### 5.3 마이크로서비스 외의 이벤트 소싱과 CQRS 

### 6. 인프라 파이프라인 구축

### 7. 마이크로서비스 인프라 구축

### 8. 개발자 워크스페이스

### 9. 마이크로서비스 개발

### 10. 마이크로서비스 릴리스

### 11. 변경 관리

### 12. 여정의 끝(그리고 새로운)
